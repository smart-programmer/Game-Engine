#version 400 core


in vec2 pass_textureCoords;
in vec3 transformedNormals;
in vec3 to_lightVector;
in vec3 to_cameraVector;
in float visibility;

out vec4 Color;

uniform sampler2D textureSampler;
uniform vec3 lightColour;
uniform float shineDamper;
uniform float reflectivity;
uniform vec3 skyColor;

void main(void){
	// start per pixel lighting calculations
	
	vec3 normalized_to_lightVector = normalize(to_lightVector);
	vec3 normalized_transformedNormals = normalize(transformedNormals);

	float brightness = dot(normalized_transformedNormals, normalized_to_lightVector);
	float clampedBrightness = max(brightness, 0.0);

	vec3 diffusedLighting = clampedBrightness * lightColour;

	// end per pixel lighting calculations
	
	// start specular lighting calculations

	vec3 reflected_from_lightVector = reflect((-1 * to_lightVector), transformedNormals);
	float specularBrightness = dot(normalize(reflected_from_lightVector), normalize(to_cameraVector));
	float clamped_specularBrightness = max(specularBrightness, 0.0);
	vec3 specularLight = (pow(clamped_specularBrightness, shineDamper) * reflectivity) * lightColour;
	
	// end specular lighting calculations

	Color = vec4(diffusedLighting, 1.0) * texture(textureSampler, pass_textureCoords) + vec4(specularLight, 1);
	Color = mix(vec4(skyColor, 1.0), Color, visibility);

}